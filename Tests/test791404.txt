

  010522  MOV     #000500, SP		; R5=177777
  010526  MOV     #010600, 000014	; Вектор 14 PC  = 010600
  010534  CLR     #000016		; Вектор 14 PSW = 000000
  010540  CLR     #000022		; Вектор 20 PSW = 000000
  010544  MOV     #010616, 000020	; Вектор 20 PC  = 010616
  010552  MOV     #000020, -(SP)	; PSW для возврата по RTT, бит T=1
  010556  MOV     #010564, -(SP)	; PC для возврата по RTT
  010562  RTT     			; PC := (SP)+; IF (PC>=1600008) THEN PSW[8:0] := (SP)+ ELSE PSW[7:0] := (SP)+

  010564  IOT     			; бит T=1;  –(SP) := CPSW; –(SP) := CPC; PC := (20); PSW := (22)

  010600  INC     R5			; R5=177777
  010602  BEQ     010522		; Возврат к началу цикла

  010522  MOV     #000500, SP
  010526  MOV     #010600, 000014
  010534  CLR     #000000
  010540  CLR     #000000
  010544  MOV     #010616, 000020
  010552  MOV     #000020, -(SP)
  010556  MOV     #010564, -(SP)
  010562  RTT     			; бит T=1;
  010564  IOT     

  010600  INC     R5			; R5=000000
  010602  BEQ     010522		; Тут детектирована ошибка; ИСПРАВЛЕНО
  010604  MOV     #000223, @#000402
  010612  INC     (R2)
  010614  HALT    



  010750  MOV     #000500, SP
  010754  MOV     #000020, -(SP)	; PSW для возврата по RTI, бит T=1
  010760  MOV     #010774, -(SP)	; PC для возврата по RTI
  010764  MOV     #011010, 000014	; Вектор 14 PC  = 011010
  010772  RTI     			; Проверяется, что RTI с битом T=1 приведет к прерыванию по вектору 14

  011010  MOV     #000016, 000014	; Вектор 14 PC  = 000016
  011016  CLR     000016		; Вектор 14 PSW = 000000
  011022  INC     @#000404
  011026  CMP     #000063, @#000404
  011034  BNE     011150
  
  011036  TSTB    @#177564
  011042  BPL     011036		; Ожидание установки бита 7 - готовности к передаче

  011044  MOV     #000500, SP
  011050  MOV     #000340, 013076
  011056  MTPS    013076                ; 340 -> PSW  -- разрешение прерываний
  011062  MOV     #011132, 000064	; Вектор 64 PC  = 011132 - Адрес прерывания по завершению передачи байта (на ошибку 227)
  011070  MOV     #000100, 177564	; Установка флага прерываний по завершению передачи байта, готовность байта к передаче
  011076  MOV     #011144, 000034	; Вектор 34 PC  = 011144 - Адрес прерывания TRAP (на ошибку 230)
  011104  MOV     #011156, 000064	; Вектор 64 PC  = 011156 - Адрес прерывания по завершению передачи байта (на продолжение теста)
  011112  MOV     #000340, 000036	; Вектор 34 PSW = 340              \
  011120  CLR     013076		;                                   +- Окно в которое должно сработать прерывание
  011124  MTPS    013076		; 0 -> PSW  -- запрет прерываний   /
  011130  TRAP    000000

  011132  MOV     #000227, @#000402
  011140  INC     (R2)
  011142  HALT    

  011144  MOV     #000230, @#000402
  011152  INC     (R2)
  011154  HALT    

  011156  CLR     000036
  011162  INC     @#000404
  011166  CMP     #000064, @#000404
  011174  BNE     011316

  011176  BIC     #000100, 177564	; Снятие флага прерываний по завершению передачи байта, готовность байта к передаче
  011204  MOV     #000500, SP
  011210  MOV     #000340, 013076
  011216  MTPS    013076		; 340 -> PSW
  011222  MOV     #000100, 177564	; Установка флага прерываний по завершению передачи байта, готовность байта к передаче
  011230  MOV     #011262, 000034	; Вектор 34 PC  = 011262 - Адрес прерывания TRAP (на IOT и ошибку 231)
  011236  MOV     #011276, 000064	; Вектор 64 PC  = 011276 - Адрес прерывания по завершению передачи байта (на продолжение теста)
  011244  MOV     #011264, 000020	; Вектор 20 PC  = 011264 - Адрес прерывания IOT (на ошибку 231)
  011252  MOV     #000340, 000022	; Вектор 20 PSW = 340
  011260  TRAP    000000
  011262  IOT     
  
  011264  MOV     #000231, @#000402
  011272  INC     (R2)

  011276  CLR     000022
  011302  CLR     000066
  011306  MOV     #000066, 000064
  011314  MOV     #000036, 000034
  011322  MOV     #000022, 000020
  011330  INC     @#000404
  011334  CMP     #000065, @#000404
  011342  BNE     011420
  011344  MTPS    #000340
  011350  MOV     #000100, 177564
  011356  MOV     #000100, 177560
  011364  RESET 
  011366  BIT     #000100, 177564
  011374  BEQ     011410

  011410  BIT     #000100, 177560
  011416  BEQ     011432

  011432  INC     @#000404
  011436  CMP     #000066, @#000404
  011444  BNE     011520

  011446  MOV     #000500, SP
  011452  MOV     #011510, 000014	; Вектор 14 PC  = 011510 - Адрес прерывания по T-разряду
  011460  MOV     #000020, -(SP)	; PSW на стек, бит T установлен
  011464  MOV     #011472, -(SP)	; PC  на стек
  011470  RTT     
  011472  RESET   			; !!! Сразу после этого 000066 HALT

  011510  CLR     013076
  011514  MTPS    013076
  011520  MOV     #000016, 000014
  011526  CLR     000016
  011532  INC     @#000404
  011536  CMP     #000067, @#000404
  011544  BNE     011722
  011546  RESET   


