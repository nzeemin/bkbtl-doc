;  #############################################################
;  #                                                           #
;  #    ƒ – ¿ … ¬ ≈ – Õ € …    Ã Œ ƒ ” À ‹    ¡   - 0 0 1 0    #
;  #                                                           #
;  #############################################################


;  –¿«–¿¡Œ“¿À:  ƒﬂ¡»Õ Ã.».
;  ÃŒ— ¬¿,  1983 √.
;
;  œŒ—À≈ƒÕﬂﬂ –≈ƒ¿ ÷»ﬂ:  Ã¿…  1984 √.



;  ====================================
;  **** ¿–√”Ã≈Õ“€  ŒÃ¿Õƒ€ EMT DMBK ****
;  ====================================



;	 À¿¬»¿“”–¿
;	----------

INDKLW	= 4		;- »Õ»÷»¿À»«¿÷»ﬂ ƒ–¿…¬≈–¿  À¿¬»¿“”–€

CTKOD	= 6		;- ◊“≈Õ»≈  Œƒ¿ —  À¿¬»¿“”–€
			;  ¬€’Œƒ:	R0 -  Œƒ ¬ ÃÀ. ¡¿…“≈

CTSTR	= 10		;- ◊“≈Õ»≈ —“–Œ » —  À¿¬»¿“”–€
			;  ¬’Œƒ:	R1 - ¿ƒ–≈— ¡”‘≈–¿ —“–Œ »
			;		R2 - ƒÀ»Õ¿ —“–Œ » (ÃÀ.¡.)
			;		   - —»Ã¬ŒÀ-Œ√–¿Õ»◊»“≈À‹ (—“.¡.)

USTKLC	= 12		;- ”—“¿ÕŒ¬ ¿  Àﬁ◊≈…  À¿¬»¿“”–€
			;  ¬’Œƒ:	R0 - ÕŒÃ≈–  Àﬁ◊¿
			;		R1 - ¿ƒ–≈— “≈ —“¿  Àﬁ◊¿


;	TV-ÃŒÕ»“Œ–
;	----------

INDMBK	= 14		;- »Õ»÷»¿À»«¿÷»ﬂ DMBK

FSIM	= 16		;- ‘Œ–Ã»–Œ¬¿Õ»≈ —»Ã¬ŒÀ¿
			;  ¬’Œƒ:	R0 -  Œƒ —»Ã¬ŒÀ¿ ¬ ÃÀ.¡.

FSTR	= 20		;- ‘Œ–Ã»–Œ¬¿Õ»≈ —“–Œ »
			;  ¬’Œƒ:	R1 - ¿ƒ–≈— —“–Œ »
			;		R2 - ƒÀ»Õ¿ —“–Œ » (ÃÀ.¡.)
			;		   - —»Ã¬ŒÀ-Œ√–¿Õ»◊»“≈À‹ (—“.¡.)

ZSIMSS	= 22		;- «¿œ»—‹ —»Ã¬ŒÀ¿ ¬ —À”∆≈¡Õ”ﬁ —“–Œ ”
			;  ¬’Œƒ:	R0 -  Œƒ —»Ã¬ŒÀ¿ (0-—¡–Œ— —“–Œ »)
			;		R1 - ÕŒÃ≈– œŒ«»÷»» ¬ ——

USTKK	= 24		;- ”—“¿ÕŒ¬ ¿  ”–—Œ–¿ œŒ  ŒŒ–ƒ»Õ¿“¿Ã
			;  ¬’Œƒ:	R1 -  ŒŒ–ƒ»Õ¿“¿ X
			;		R2 -  ŒŒ–ƒ»Õ¿“¿ Y

SEMKK	= 26		;- —'≈Ã  ŒŒ–ƒ»Õ¿“  ”–—Œ–¿
			;  ¬€’Œƒ:	R1 -  ŒŒ–ƒ»Õ¿“¿ X
			;		R2 -  ŒŒ–ƒ»Õ¿“¿ Y

FTCK	= 30		;- ‘Œ–Ã»–Œ¬¿Õ»≈ “Œ◊ »
			;  ¬’Œƒ:	R0 - 1-«¿œ»—‹, 0-—“»–¿Õ»≈
			;		R1 -  ŒŒ–ƒ»Õ¿“¿ X
			;		R2 -  ŒŒ–ƒ»Õ¿“¿ Y

FWEKT	= 32		;- ‘Œ–Ã»–Œ¬¿Õ»≈ ¬≈ “Œ–¿
			;  ¬’Œƒ:	R0 - 1-«¿œ»—‹, 0-—“»–¿Õ»≈
			;		R1 -  ŒŒ–ƒ»Õ¿“¿ X
			;		R2 -  ŒŒ–ƒ»Õ¿“¿ Y

CTSSD	= 34		;- ◊“≈Õ»≈ —ÀŒ¬¿ —Œ—“ŒﬂÕ»ﬂ ƒ»—œÀ≈ﬂ
			;  ¬€’Œƒ:	R0 - —ÀŒ¬Œ —Œ—“. ƒ»—œÀ.


;	Ã¿√Õ»“Œ‘ŒÕ
;	----------

DMAG	= 36		;- ƒ–¿…¬≈– Ã¿√Õ»“Œ‘ŒÕ¿
			;  ¬’Œƒ:	R1 - ¿ƒ–≈— ¡ÀŒ ¿ œ¿–¿Ã≈“–Œ¬


;	TLG- ¿Õ¿À
;	---------

INDTLG	= 40		;- »Õ»÷»¿À»«¿÷»ﬂ ƒ–¿…¬≈–¿ “À√- ¿Õ¿À¿
			;  ¬’Œƒ:	R0 - ÕŒÃ≈– — Œ–Œ—“»

PDBYT	= 42		;- œ≈–≈ƒ¿◊¿ ¡¿…“¿
			;  ¬’Œƒ:	R0 - ÃÀ.¡. Õ¿ œ≈–≈ƒ¿◊”

PRBYT	= 44		;- œ–»≈Ã ¡¿…“¿
			;  ¬€’Œƒ:	R0 - ÃÀ.¡. œ–»Õﬂ“

PDMAS	= 46		;- œ≈–≈ƒ¿◊¿ Ã¿——»¬¿
			;  ¬’Œƒ:	R1 - ¿ƒ–≈— Ã¿——»¬¿
			;		R2 - ƒÀ»Õ¿ Ã¿——»¬¿

PRMAS	= 50		;- œ–»≈Ã Ã¿——»¬¿
			;  ¬’Œƒ:	R1 - ¿ƒ–≈— ¡”‘≈–¿ Ã¿——»¬¿
			;		R2 - ƒÀ»Õ¿ Ã¿——»¬¿


;	–≈«≈–¬
;	------

RW1	= 52
RW2	= 54
RW3	= 56
RW4	= 60
RW5	= 62
RW6	= 64
RW7	= 66
RW8	= 70
RW9	= 72
RW10	= 74
RW11	= 76
RW12	= 100
RW13	= 102
RW14	= 104
RW15	= 106
RW16	= 110



;   ======================
;   ***  ŒÕ—“¿Õ“€ DMBK ***
;   ======================


	AWPZAW	= 4		;- ¿ƒ–.¬≈ “.œ–≈–. œŒ «¿¬»—¿Õ»ﬁ
	AWPEMT	= 30		;- ¿ƒ–.¬≈ “.œ–≈–. œŒ  ŒÃ¿Õƒ≈ ≈Ã“
	APORT	= 177714	;- ¿ƒ–≈— œŒ–“¿
	ASPORT	= 177716	;- ¿ƒ–≈— —»—“≈ÃÕŒ√Œ œŒ–“¿




;  ============================
;  **** Œ¡À¿—“‹ —¬ﬂ«» DMBK ****
;  ============================



DMBK:	JMP	MNDMBK		;- œ≈–≈’Œƒ Õ¿ ÃŒÕ»“Œ– DMBK


;    -------------------------------
;    ** ¬’Œƒ€ ƒ–¿…¬≈–¿  À¿¬»¿“”–€ **
;    -------------------------------

WIDKLW:	.WORD	MIDKLW		;- ¬’Œƒ »Õ»÷»¿À»«¿÷»» DKLAW
WCTKOD:	.WORD	MCTKOD		;- ¬’Œƒ ◊“≈Õ»ﬂ  Œƒ¿
WCTSTR:	.WORD	MCTSTR		;- ¬’Œƒ ◊“≈Õ»ﬂ —“–Œ »
WUKLC:	.WORD	MUKLC		;- ¬’Œƒ ”—“¿ÕŒ¬ »  Àﬁ◊≈…


;    --------------------------------
;    ** ¬’Œƒ€ ƒ–¿…¬≈–¿ TV-ÃŒÕ»“Œ–¿ **
;    --------------------------------

WIDMBK:	.WORD	MIDMBK		;- ¬’Œƒ »Õ»÷»¿À»«¿÷»» DMBK
WFSIM:	.WORD	MFSIM		;- ¬’Œƒ ‘Œ–Ã»–Œ¬¿Õ»ﬂ —»Ã¬ŒÀ¿
WFSTR:	.WORD	MFSTR		;- ¬’Œƒ ‘Œ–Ã»–Œ¬¿Õ»ﬂ —“–Œ »
WZSSS:	.WORD	MZSSS		;- ¬’Œƒ «¿œ»—» —»Ã¬ŒÀ¿ ¬ —À”∆. —“–Œ ”
WUSTKK:	.WORD	MUSTKK		;- ¬’Œƒ ”—“¿ÕŒ¬ »  ŒŒ–ƒ»Õ¿“  ”–—Œ–¿
WSKK:	.WORD	MSKK		;- ¬’Œƒ —'≈Ã¿  ŒŒ–ƒ»Õ¿“  ”–—Œ–¿
WFTCK:	.WORD	MFTCK		;- ¬’Œƒ ‘Œ–Ã»–Œ¬¿Õ»ﬂ “Œ◊ »
WFWEKT:	.WORD	MFWEKT		;- ¬’Œƒ ‘Œ–Ã»–Œ¬¿Õ»ﬂ ¬≈ “Œ–¿
WCTSSD:	.WORD	MCTSSD		;- ¬’Œƒ ◊“≈Õ»ﬂ ——ƒ


;    --------------------------------
;    ** ¬’Œƒ€ ƒ–¿…¬≈–¿ Ã¿√Õ»“Œ‘ŒÕ¿ **
;    --------------------------------

WDMAG:	.WORD	MDMAG		;- ¬’Œƒ «¿œ»—»/◊“≈Õ»ﬂ Ã¿——»¬¿


;    -------------------------------
;    ** ¬’Œƒ€ ƒ–¿…¬≈–¿ “À√- ¿Õ¿À¿ **
;    -------------------------------

WIDTLG:	.WORD	MIDTLG		;- ¬’Œƒ »Õ»÷»¿À»«¿÷»» DTLG
WPDBYT:	.WORD	MPDBYT		;- ¬’Œƒ œ≈–≈ƒ¿◊» ¡¿…“¿
WPRBYT:	.WORD	MPRBYT		;- ¬’Œƒ œ–»≈Ã¿ ¡¿…“¿
WPDMAS:	.WORD	MPDMAS		;- ¬’Œƒ œ≈–≈ƒ¿◊» Ã¿——»¬¿
WPRMAS:	.WORD	MPRMAS		;- ¬’Œƒ œ–»≈Ã¿ Ã¿——»¬¿


;    --------------------------
;    ** –≈«≈–¬Õ€≈ ¬’Œƒ€ DMBK **
;    --------------------------

RWDM1:	.WORD	160000
RWDM2:	.WORD	160004
RWDM3:	.WORD	160010
RWDM4:	.WORD	160014
RWDM5:	.WORD	160020
RWDM6:	.WORD	160024
RWDM7:	.WORD	160030
RWDM8:	.WORD	160034
RWDM9:	.WORD	160040
RWDM10:	.WORD	160044
RWDM11:	.WORD	160050
RWDM12:	.WORD	160054
RWDM13:	.WORD	160060
RWDM14:	.WORD	160064
RWDM15:	.WORD	160070
RWDM16:	.WORD	160074





; ==============================
; *****  ƒ»—œ≈“◊≈–  ≈ Ã “  *****
; ==============================


DEMT:	MOV	R5,-(SP)

	MOV	2(SP),R5	;  ¿ƒ–≈— ÃŒƒ”Àﬂ
	MOV	-(R5),R5
	BIC	#177400,R5
	MOV	DMBK(R5),R5

	JSR	PC,(R5)		;  Œ¡–¿Ÿ≈Õ»≈   ÃŒƒ”Àﬁ

	MOV	(SP)+,R5
	RTI





; =====================================
; ***** ÃŒƒ”À‹ »Õ»÷»¿À»«¿÷»» DMBK *****
; =====================================


MIDMBK:	CLR	R1		;  ”—“¿ÕŒ¬ ¿ ¬≈ “Œ–Œ¬
	MOV	#20,R2
1$:	MOV	#100000,(R1)+
	SOB	R2,1$
	MOV	#MNZAW,@#AWPZAW
	MOV	#DEMT,@#AWPEMT
	MOV	#200,@#AWPEMT+2

	MOV	#120,R2		;  —¡–Œ— œ–»«Õ¿ Œ¬
2$:	CLR	(R1)+
	SOB	R2,2$

	EMT	INDKLW		;- »Õ»÷»¿À»«¿÷»ﬂ DKLAW

	INC	DSIMB		;- »Õ»÷»¿À»«¿÷»ﬂ DTVM
	INCB	NMPGT
	COM	MASCW
	COM	MCWSS
	JSR	PC,PPRP1

	MOV	#KDBIT0,DLBIT0	;- »Õ»÷»¿À»«¿÷»ﬂ DMAG
	MOV	#KDBIT1,DLBIT1

	CLR	R0
	EMT	INDTLG		;- »Õ»÷»¿À»«¿÷»ﬂ DTLG

	CLR	@#APORT		;- —¡–Œ— œŒ–“¿
	MOV	#220,@#ASPORT	;- ”—“¿ÕŒ¬ ¿ —»—“≈ÃÕŒ√Œ œŒ–“¿

	MTPS	R0		;- –¿«–≈ÿ≈Õ»≈ œ–≈–€¬¿Õ»…

	RTS	PC





; ======================================
; *****  Ã Œ Õ » “ Œ –    D M B K  *****
; ======================================




MNDMBK:	MOV	#1000,SP	;- ”—“¿ÕŒ¬ ¿ —“≈ ¿
	JSR	PC,MIDMBK

	JSR	PC,@#120000	;- «¿œ”—  ‘Œ ¿À¿
	JSR	PC,MIDMBK	;- ¬€’Œƒ »« ‘Œ ¿À¿

MNKOM:	JSR	R5,PPCT		;- "ÃŒÕ»“Œ– ¡ -0010"
	.WORD	TMON
MNKOM1:	JSR	R5,PPCT		;- ">"
	.WORD	TPRIGL

	MOV	SP,R1		;  œ–»≈Ã  ŒÃ¿Õƒ€
	SUB	#100,R1
	MOV	R1,R5
2$:	EMT	CTKOD
	CMPB	R0,#30		;- ¿Õ—
	BNE	1$
	CMP	R5,R1
	BEQ	2$
3$:	CLR	(R5)+
4$:	EMT	FSIM
	BR	2$
1$:	MOV	R0,-(R5)	;- «¿œ»—‹  Œƒ¿ ¬ ¡”‘≈–
	TSTB	R5
	BEQ	3$
	CMPB	R0,#12		;- "œ—"
	BNE	4$
	EMT	FSIM

	MOV	-(R1),R4	;  ◊“≈Õ»≈  ŒÃ¿Õƒ€
	CLR	R5		;- ◊»—ÀŒ
	MOV	R4,R3
7$:	CMP	R3,R0		;- "œ—"
	BEQ	5$
	CMP	R3,#67		;- ÷»‘–¿
	BHI	6$
	SUB	#60,R3
	BMI	6$
	ASL	R5
	ASL	R5
	ASL	R5
	ADD	R3,R5
6$:	MOV	-(R1),R3	;- ◊“≈Õ»≈ —À≈ƒ.—»Ã¬.
	BR	7$

5$:	BIC	#240,R4		;  ¿Õ¿À»«  ŒÃ¿Õƒ€
	CMPB	R4,#124		;- "T"
	BHI	10$
	SUB	#114,R4		;- "L"
	BMI	11$
	ASL	R4

	MOV	MNKOMT(R4),R1	;  œ≈–≈ƒ¿◊¿ ”œ–¿¬À≈Õ»ﬂ
	JSR	PC,(R1)
	BR	MNKOM1

11$:	ADD	#13,R4		;- A : K
	BPL	MNDMBK
	BR	MNKOM1

10$:	JSR	PC,@#160110	;- > T
	BR	MNKOM1

MNKOMT:	.WORD	PCTTLG		;- "L"
	.WORD	PCTMAG		;- "M"
	.WORD	160110		;- "N"
	.WORD	160110		;- "O"
	.WORD	140000		;- "P"
	.WORD	160110		;- "Q"
	.WORD	160104		;- "R"
	.WORD	PSTART		;- "S"
	.WORD	160100		;- "T"



;    -----------------------------------
;    ** 0. Œ¡–¿¡Œ“ ¿ «¿¬»—¿Õ»ﬂ » —“Œœ **
;    -----------------------------------

MNZAW:	MOV	#1000,SP
	MOV	#220,@#ASPORT
	EMT	INDKLW
	BR	MNKOM


;    -----------------------------
;    ** 1. ◊“≈Õ»≈ ‘¿…À¿ — À»Õ»» **
;    -----------------------------

PCTTLG:	EMT	PRBYT		;  ”—“¿ÕŒ¬ ¿ —¬ﬂ«»
	EMT	PDBYT

	MOV	#BUFSTA,R1	;  œ–»≈Ã ¿ƒ–≈—¿ » ƒÀ»Õ€
	MOV	#4,R2
	EMT	PRMAS
	TST	R5
	BEQ	1$
	MOV	R5,BUFSTA

1$:	MOV	BUFSTA,R1	;  œ–»≈Ã Ã¿——»¬¿
	MOV	BUFDL,R2
	EMT	PRMAS
	JSR	R5,PPCT		;- œ≈◊¿“‹ —ŒŒ¡Ÿ≈Õ»ﬂ
	.WORD	TFZ

	RTS	PC


;    -----------------------------------
;    ** 2. ◊“≈Õ»≈ ‘¿…À¿ — Ã¿√Õ»“Œ‘ŒÕ¿ **
;    -----------------------------------

PCTMAG:	MOV	#BPDMAG,R1	;  «¿√–”« ¿ BPDMAG
	MOV	#3,(R1)+	;-  ŒÃ¿Õƒ¿
	MOV	R5,(R1)+	;- ¿ƒ–≈—
	CLR	(R1)+		;- ƒÀ»Õ¿
	JSR	R5,PPCT		;- "»Ãﬂ ‘¿…À¿?"
	.WORD	TIMF
	MOV	#5020,R2
	EMT	CTSTR
	DEC	R1
2$:	MOVB	#40,(R1)+
	DEC	R2
	BPL	2$

1$:	MOV	#BPDMAG,R1	;  ◊“≈Õ»≈ ‘¿…À¿
	EMT	DMAG

	MOVB	1(R1),R0	;  ¿Õ¿À»« Œ“¬≈“¿
	BEQ	4$
	DEC	R0
	BNE	3$
	JSR	PC,5$		;- œ≈◊¿“‹ »Ã. “≈ . ‘¿…À¿
	MOV	#12,R0
	EMT	FSIM
	BR	1$

3$:	JSR	R5,PPCT		;- "*Œÿ»¡ ¿*"
	.WORD	TOH
	BR	KCTMAG

4$:	JSR	R5,PPCT		;- "«¿√–”∆≈Õ ‘¿…À "
	.WORD	TZF
5$:	ADD	#32,R1
	MOV	#20,R2
	EMT	FSTR

KCTMAG:	RTS	PC


;    --------------
;    ** 3. —“¿–“ **
;    --------------

PSTART:	TST	R5
	BNE	1$
	MOV	BUFSTA,R5	;- —“¿–“Œ¬€… ¿ƒ–≈—
1$:	JSR	PC,(R5)

	RTS	PC


;    ----------------------
;    ** 4. œ≈◊¿“‹ “≈ —“¿ **
;    ----------------------

PPCT:	MOV	(R5)+,R3
	BR	1$
2$:	EMT	FSIM
1$:	MOVB	(R3)+,R0
	BNE	2$

	RTS	R5



;   =====================
;   *** ƒ¿ÕÕ€≈ MNDMBK ***
;   =====================


TMON:	.BYTE	12,355,357,356,351,364,357,362,40	;  ÃŒÕ»“Œ– ¡ -0010
	.BYTE	342,353,55,60,60,61,60,0
TPRIGL:	.BYTE	12,12,76,40,0				;  >
TIMF:	.BYTE	351,315,321,40,306,301,312,314,301,77,40,0 ;  »Ãﬂ ‘¿…À¿?
TZF:	.BYTE	12,372,301,307,322,325,326,305,316,40	;  «¿√–”∆≈Õ ‘¿…À
	.BYTE	306,301,312,314,40,0
TFZ:	.BYTE	12,346,301,312,314,40			;  ‘¿…À «¿√–”∆≈Õ
	.BYTE	332,301,307,322,325,326,305,316,0
TOH:	.BYTE	12,52,357,373,351,342,353,341,52,0	;  *Œÿ»¡ ¿*
	.EVEN
